{
  "title": "Bindfit",
  "description": "Binding constant fitter",
  "algorithms": [
    {
      "name": "bindfit",
      "title": "Bindfit",
      "code": "ZGVmIG1haW4oCiAgICBkYXRhLAogICAgcGFyYW1zLAogICAgb3B0aW9ucywKICAgICoqa3dhcmdzLAopOgogICAgaW1wb3J0IG51bXB5IGFzIG5wCiAgICBpbXBvcnQgcGFuZGFzIGFzIHBkCgogICAgaW1wb3J0IGJpbmRmaXQKCgogICAgIyBDb252ZXJ0IHBhcmFtcyB0byBCaW5kZml0IGZvcm1hdAogICAgIyBUT0RPOiBNb2RpZnkgbGlicmFyeSB0byBhY2NlcHQgRnJpY3Rpb25sZXNzIHBhcmFtcyBmb3JtYXQKICAgIGJpbmRmaXRfcGFyYW1zID0ge30KCiAgICBmb3Iga2V5LCBwYXJhbSBpbiBwYXJhbXNbImRhdGEiXS5pdGVtcygpOgogICAgICAgIGJpbmRmaXRfcGFyYW1zLnVwZGF0ZSh7CiAgICAgICAgICAgIGtleTogewogICAgICAgICAgICAgICAgImluaXQiOiBwYXJhbVsidmFsdWUiXSwKICAgICAgICAgICAgICAgICJib3VuZHMiOiB7CiAgICAgICAgICAgICAgICAgICAgIm1pbiI6IHBhcmFtWyJsb3dlckJvdW5kIl0sCiAgICAgICAgICAgICAgICAgICAgIm1heCI6IHBhcmFtWyJ1cHBlckJvdW5kIl0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgfSkKCiAgICAjIEJpbmRmaXQgb3B0aW9ucwogICAgbW9kZWwgPSBvcHRpb25zWyJkYXRhIl1bIm1vZGVsIl0KICAgIG1ldGhvZCA9IG9wdGlvbnNbImRhdGEiXVsibWV0aG9kIl0KICAgIG5vcm1hbGlzZSA9IG9wdGlvbnNbImRhdGEiXVsibm9ybWFsaXNlIl0KICAgIGRpbHV0ZSA9IG9wdGlvbnNbImRhdGEiXVsiZGlsdXRlIl0KICAgIGZsYXZvdXIgPSBvcHRpb25zWyJkYXRhIl1bImZsYXZvdXIiXQoKICAgICMgTG9hZCBkYXRhCiAgICAjIFRPRE86IFNwbGl0IHRoaXMgZnVuY3Rpb24gb3V0IGludG8gZGF0YXBhY2thZ2UtdXRpbGl0aWVzIGxpYnJhcnkKICAgIGRlZiBkYXRhcGFja2FnZV90b19kYXRhZnJhbWUoZHApOgogICAgICAgIGRmID0gcGQuRGF0YUZyYW1lLmZyb21fZGljdChkcFsiZGF0YSJdKQogICAgICAgICMgUmVvcmRlciBjb2x1bW5zIGJ5IHNjaGVtYSBmaWVsZCBvcmRlcgogICAgICAgIGNvbHMgPSBbIGZpZWxkWyJuYW1lIl0gZm9yIGZpZWxkIGluIGRwWyJzY2hlbWEiXVsiZmllbGRzIl0gXQogICAgICAgIGRmID0gZGZbY29sc10KICAgICAgICByZXR1cm4gZGYKCiAgICBkZiA9IGRhdGFwYWNrYWdlX3RvX2RhdGFmcmFtZShkYXRhKQoKICAgICMgQmluZGZpdCBleHBlY3RzIGVhY2ggdmFyaWFibGUgYXMgcm93cwogICAgZGF0YV94ID0gbnAudHJhbnNwb3NlKGRmLmlsb2NbOiwgOjJdLnRvX251bXB5KCkpCiAgICBkYXRhX3kgPSBucC50cmFuc3Bvc2UoZGYuaWxvY1s6LCAyOl0udG9fbnVtcHkoKSkKCiAgICAjIEFwcGx5IGRpbHV0aW9uIGNvcnJlY3Rpb24KICAgICMgVE9ETzogVGhpbmsgYWJvdXQgd2hlcmUgdGhpcyBzaG91bGQgZ28gLSBmaXR0ZXIgb3IgZnVuY3Rpb24/CiAgICAjIE9yIGp1c3QgYXBwbHkgaXQgYmVmb3JlIHRoZSBmaXQ/CiAgICBpZiBkaWx1dGU6CiAgICAgICAgZGF0YV95ID0gYmluZGZpdC5oZWxwZXJzLmRpbHV0ZShkYXRhX3hbMF0sIGRhdGFfeSkKCiAgICBmdW5jdGlvbiA9IGJpbmRmaXQuZnVuY3Rpb25zLmNvbnN0cnVjdCgKICAgICAgICBtb2RlbCwKICAgICAgICBub3JtYWxpc2U9bm9ybWFsaXNlLAogICAgICAgIGZsYXZvdXI9Zmxhdm91ciwKICAgICkKCiAgICBmaXR0ZXIgPSBiaW5kZml0LmZpdHRlci5GaXR0ZXIoCiAgICAgICAgZGF0YV94LCBkYXRhX3ksIGZ1bmN0aW9uLCBub3JtYWxpc2U9bm9ybWFsaXNlLCBwYXJhbXM9YmluZGZpdF9wYXJhbXMKICAgICkKCiAgICBmaXR0ZXIucnVuX3NjaXB5KGJpbmRmaXRfcGFyYW1zLCBtZXRob2Q9bWV0aG9kKQoKICAgIHN1bW1hcnkgPSB7CiAgICAgICAgImZpdHRlciI6IG1vZGVsLAogICAgICAgICJmaXQiOiB7CiAgICAgICAgICAgICJ5IjogZml0dGVyLmZpdCwKICAgICAgICAgICAgImNvZWZmc19yYXciOiBmaXR0ZXIuY29lZmZzX3JhdywKICAgICAgICAgICAgImNvZWZmcyI6IGZpdHRlci5jb2VmZnMsCiAgICAgICAgICAgICJtb2xlZnJhY19yYXciOiBmaXR0ZXIubW9sZWZyYWNfcmF3LAogICAgICAgICAgICAibW9sZWZyYWMiOiBmaXR0ZXIubW9sZWZyYWMsCiAgICAgICAgICAgICJwYXJhbXMiOiBmaXR0ZXIucGFyYW1zLAogICAgICAgICAgICAibl95IjogbnAuYXJyYXkoZml0dGVyLmZpdCkuc2l6ZSwKICAgICAgICAgICAgIm5fcGFyYW1zIjogbGVuKGZpdHRlci5wYXJhbXMpICsgbnAuYXJyYXkoZml0dGVyLmNvZWZmc19yYXcpLnNpemUsCiAgICAgICAgfSwKICAgICAgICAicW9mIjogewogICAgICAgICAgICAicmVzaWR1YWxzIjogZml0dGVyLnJlc2lkdWFscywKICAgICAgICAgICAgInNzciI6IGJpbmRmaXQuaGVscGVycy5zc3IoZml0dGVyLnJlc2lkdWFscyksCiAgICAgICAgICAgICJybXMiOiBiaW5kZml0LmhlbHBlcnMucm1zKGZpdHRlci5yZXNpZHVhbHMpLAogICAgICAgICAgICAiY292IjogYmluZGZpdC5oZWxwZXJzLmNvdihkYXRhX3ksIGZpdHRlci5yZXNpZHVhbHMpLAogICAgICAgICAgICAicm1zX3RvdGFsIjogYmluZGZpdC5oZWxwZXJzLnJtcyhmaXR0ZXIucmVzaWR1YWxzLCB0b3RhbD1UcnVlKSwKICAgICAgICAgICAgImNvdl90b3RhbCI6IGJpbmRmaXQuaGVscGVycy5jb3YoZGF0YV95LCBmaXR0ZXIucmVzaWR1YWxzLCB0b3RhbD1UcnVlKSwKICAgICAgICB9LAogICAgICAgICJ0aW1lIjogZml0dGVyLnRpbWUsCiAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICJkaWx1dGUiOiBkaWx1dGUsCiAgICAgICAgICAgICJub3JtYWxpc2UiOiBub3JtYWxpc2UsCiAgICAgICAgICAgICJtZXRob2QiOiBtZXRob2QsCiAgICAgICAgICAgICJmbGF2b3VyIjogZmxhdm91ciwKICAgICAgICB9LAogICAgfQoKICAgIHJldHVybiBzdW1tYXJ5Cg==",
      "inputs": [
        {
          "name": "data",
          "type": "resource",
          "resource": "data"
        },
        {
          "name": "params",
          "type": "resource",
          "resource": "inputParams"
        },
        {
          "name": "options",
          "type": "resource",
          "resource": "options"
        }
      ],
      "outputs": [
        {
          "name": "params",
          "type": "resource",
          "resource": "outputParams"
        }
      ]
    }
  ],
  "resources": [
    {
      "name": "data",
      "title": "Data",
      "description": "Input data",
      "profile": "tabular-data-resource",
      "data": [],
      "schema": {
        "primaryKey": "H",
        "fields": [
          {
            "name": "H",
            "type": "number",
            "title": "",
            "unit": ""
          },
          {
            "name": "G",
            "type": "number",
            "title": "",
            "unit": ""
          }
        ]
      }
    },
    {
      "name": "inputParams",
      "title": "Input parameters",
      "description": "Initial parameter values",
      "profile": "parameter-data-resource",
      "data": {
        "k": {
          "vary": true,
          "value": 100,
          "lowerBound": 0,
          "upperBound": null
        }
      },
      "schema": {
        "keys": [
          {
            "name": "k",
            "unit": "M^{-1}",
            "fields": [
              {
                "name": "vary",
                "title": "Vary",
                "type": "boolean"
              },
              {
                "name": "value",
                "title": "Value",
                "type": "number"
              },
              {
                "name": "lowerBound",
                "title": "Lower bound",
                "type": "number"
              },
              {
                "name": "upperBound",
                "title": "Upper bound",
                "type": "number"
              }
            ]
          }
        ]
      }
    },
    {
      "name": "outputParams",
      "title": "Optimised parameters",
      "description": "Optimised parameter values",
      "profile": "parameter-data-resource"
    },
    {
      "name": "options",
      "title": "Fit options",
      "description": "Fit options",
      "profile": "options-data-resource",
      "data": {
        "model": "nmr1to1",
        "method": "Nelder-Mead",
        "normalise": true,
        "dilute": false,
        "flavour": "none"
      },
      "schema": {
        "fields": [
          {
            "name": "model",
            "title": "Fit model",
            "description": "The model to fit to the data",
            "type": "object",
            "objectFields": [
              {
                "name": "title",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              }
            ],
            "constraints": {
              "enum": [
                {
                  "title": "NMR 1:1",
                  "name": "nmr1to1"
                }
              ]
            }
          },
          {
            "name": "method",
            "title": "Fit method",
            "description": "The optimisation method to use for fitting",
            "type": "object",
            "objectFields": [
              {
                "name": "title",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              }
            ],
            "constraints": {
              "enum": [
                {
                  "title": "Nelder-Mead",
                  "name": "Nelder-Mead"
                },
                {
                  "title": "L-BFGS-B",
                  "name": "L-BFGS-B"
                }
              ]
            }
          },
          {
            "name": "normalise",
            "title": "Subtract initial values",
            "description": "Subtract initial values from data before fitting",
            "type": "boolean"
          },
          {
            "name": "dilute",
            "title": "Dilution correction",
            "description": "Apply dilution correction to data",
            "type": "boolean"
          },
          {
            "name": "flavour",
            "title": "Flavour",
            "description": "Fitting algorithm flavour",
            "type": "object",
            "objectFields": [
              {
                "name": "title",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              }
            ],
            "constraints": {
              "enum": [
                {
                  "title": "None (Full)",
                  "name": "none"
                },
                {
                  "title": "Non-cooperative",
                  "name": "noncoop"
                },
                {
                  "title": "Additive",
                  "name": "add"
                },
                {
                  "title": "Statistical",
                  "name": "stat"
                }
              ]
            }
          }
        ]
      }
    }
  ],
  "views": [
    {
      "name": "data",
      "specType": "opendatafit-upload",
      "spec": {},
      "resources": [
        "data"
      ]
    },
    {
      "name": "params",
      "title": "Parameters",
      "specType": "opendatafit-params",
      "spec": {
        "keys": [
          {
            "name": "k"
          }
        ]
      },
      "resources": [
        "inputParams",
        "outputParams"
      ]
    }
  ],
  "displays": [
    {
      "name": "main",
      "algorithms": [
        "bindfit"
      ],
      "layout": {
        "type": "bindfit",
        "spec": {
          "panes": [
            {
              "name": "control",
              "tabs": [
                "data",
                "params"
              ]
            },
            {
              "name": "main",
              "tabs": []
            }
          ],
          "tabs": [
            {
              "name": "data",
              "title": "Data",
              "icon": "",
              "views": [
                "data"
              ]
            },
            {
              "name": "params",
              "title": "Parameters",
              "icon": "",
              "views": [
                "params"
              ]
            }
          ]
        }
      }
    }
  ]
}